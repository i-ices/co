(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{551:function(e,t,n){},643:function(e,t,n){"use strict";n(551)},659:function(e,t,n){"use strict";n.r(t);n(7),n(55),n(22),n(282),n(176),n(161),n(94),n(61),n(63),n(596),n(270),n(598),n(600),n(606),n(607),n(609),n(610),n(612),n(615),n(616),n(617),n(618),n(619),n(620),n(621),n(622),n(624),n(625),n(626),n(627),n(628),n(629),n(630),n(631),n(632),n(633),n(634),n(635),n(637),n(265),n(28),n(34),n(639),n(642),n(74),n(283);var i={name:"m3u8-downloader",data:function(){return{url:"",tips:"m3u8 视频在线提取工具",isPause:!1,isGetMP4:!1,durationSecond:0,downloading:!1,beginTime:"",errorNum:0,finishNum:0,downloadIndex:0,finishList:[],tsUrlList:[],mediaFileList:[],rangeDownload:{isShowRange:!1,startSegment:"",endSegment:"",targetSegment:1},aesConf:{method:"",uri:"",iv:"",key:"",decryptor:null,stringToBuffer:function(e){return(new TextEncoder).encode(e)}}}},mounted:function(){this.loadJs("https://upyun.luckly-mjw.cn/lib/aes-decryptor.js"),this.loadJs("https://upyun.luckly-mjw.cn/lib/mux-mp4.js")},methods:{loadJs:function(e){return new Promise((function(t,n){var i=document.createElement("script");i.type="text/javascript",i.src=e,document.body.appendChild(i),i.onload=function(){t()},i.onerror=function(){n()}}))},ajax:function(e){e=e||{};var t=new XMLHttpRequest;"file"===e.type&&(t.responseType="arraybuffer"),t.onreadystatechange=function(){if(4===t.readyState){var n=t.status;n>=200&&n<300?e.success&&e.success(t.response):e.fail&&e.fail(n)}},t.open("GET",e.url,!0),t.send(null)},applyURL:function(e,t){if(t=t||location.href,0===e.indexOf("http"))return e;if("/"===e[0]){var n=t.split("/");return n[0]+"//"+n[2]+e}var i=t.split("/");return i.pop(),i.join("/")+"/"+e},getMP4:function(){this.isGetMP4=!0,this.getM3U8()},getM3U8:function(e){var t=this;this.url?-1!==this.url.toLowerCase().indexOf(".m3u8")?this.downloading?alert("资源下载中，请稍后"):location.href.indexOf("blog.luckly-mjw.cn")>-1&&-1===this.url.indexOf(location.protocol)?location.href="".concat(this.url.split(":")[0],"://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html?source=").concat(this.url):(location.href.indexOf("blog.luckly-mjw.cn")>-1&&window.history.replaceState(null,"","".concat(location.href.split("?")[0],"?source=").concat(this.url)),this.tips="m3u8 文件下载中，请稍后",this.beginTime=new Date,this.ajax({url:this.url,success:function(n){if(t.tsUrlList=[],t.finishList=[],n.split("\n").forEach((function(e){(e.toLowerCase().indexOf(".ts")>-1||e.toLowerCase().indexOf(".image")>-1)&&(t.tsUrlList.push(t.applyURL(e,t.url)),t.finishList.push({title:e,status:""}))})),e)return t.rangeDownload.isShowRange=!0,t.rangeDownload.endSegment=t.tsUrlList.length,void(t.rangeDownload.targetSegment=t.tsUrlList.length);var i=Math.max(t.rangeDownload.startSegment||1,1),o=Math.max(t.rangeDownload.endSegment||t.tsUrlList.length,1);if(i=Math.min(i,t.tsUrlList.length),o=Math.min(o,t.tsUrlList.length),t.rangeDownload.startSegment=Math.min(i,o),t.rangeDownload.endSegment=Math.max(i,o),t.rangeDownload.targetSegment=t.rangeDownload.endSegment-t.rangeDownload.startSegment+1,t.downloadIndex=t.rangeDownload.startSegment-1,t.downloading=!0,t.isGetMP4){var s=0;n.split("\n").forEach((function(e){e.toUpperCase().indexOf("#EXTINF:")>-1&&(s++,t.rangeDownload.startSegment<=s&&s<=t.rangeDownload.endSegment&&(t.durationSecond+=parseFloat(e.split("#EXTINF:")[1])))}))}n.indexOf("#EXT-X-KEY")>-1?(t.aesConf.method=(n.match(/(.*METHOD=([^,\s]+))/)||["","",""])[2],t.aesConf.uri=(n.match(/(.*URI="([^"]+))"/)||["","",""])[2],t.aesConf.iv=(n.match(/(.*IV=([^,\s]+))/)||["","",""])[2],t.aesConf.iv=t.aesConf.iv?t.aesConf.stringToBuffer(t.aesConf.iv):"",t.aesConf.uri=t.applyURL(t.aesConf.uri,t.url),t.getAES()):t.tsUrlList.length>0?t.downloadTS():t.alertError("资源为空，请查看链接是否有效")},fail:function(){t.alertError("链接不正确，请查看链接是否有效")}})):alert("链接有误，请重新输入"):alert("请输入链接")},getAES:function(){var e=this;alert("视频被 AES 加密，点击确认，进行视频解码"),this.ajax({type:"file",url:this.aesConf.uri,success:function(t){e.aesConf.key=t,e.aesConf.decryptor=new AESDecryptor,e.aesConf.decryptor.constructor(),e.aesConf.decryptor.expandKey(e.aesConf.key),e.downloadTS()},fail:function(){e.alertError("视频已进行定制化加密，不提供定制化解密下载")}})},aesDecrypt:function(e,t){var n=this.aesConf.iv||new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t]);return this.aesConf.decryptor.decrypt(e,0,n.buffer||n,!0)},downloadTS:function(){var e=this;this.tips="ts 视频碎片下载中，请稍后";for(var t=function t(){var n=e.isPause,i=e.downloadIndex;e.downloadIndex++,e.finishList[i]&&""===e.finishList[i].status?e.ajax({url:e.tsUrlList[i],type:"file",success:function(o){e.dealTS(o,i,(function(){return e.downloadIndex<e.rangeDownload.endSegment&&!n&&t()}))},fail:function(){e.errorNum++,e.finishList[i].status="error",e.downloadIndex<e.rangeDownload.endSegment&&!n&&t()}}):e.downloadIndex<e.rangeDownload.endSegment&&!n&&t()},n=0;n<Math.min(10,this.rangeDownload.targetSegment-this.finishNum);n++)t()},dealTS:function(e,t,n){var i=this,o=this.aesConf.uri?this.aesDecrypt(e,t):e;this.conversionMp4(o,t,(function(e){i.mediaFileList[t-i.rangeDownload.startSegment+1]=e,i.finishList[t].status="finish",i.finishNum++,i.finishNum===i.rangeDownload.targetSegment&&i.downloadFile(i.mediaFileList,i.formatTime(i.beginTime,"YYYY_MM_DD hh_mm_ss")),n&&n()}))},conversionMp4:function(e,t,n){var i=this;if(this.isGetMP4){var o=new muxjs.Transmuxer({keepOriginalTimestamps:!0,duration:parseInt(this.durationSecond)});o.on("data",(function(e){if(t===i.rangeDownload.startSegment-1){var o=new Uint8Array(e.initSegment.byteLength+e.data.byteLength);o.set(e.initSegment,0),o.set(e.data,e.initSegment.byteLength),n(o.buffer)}else n(e.data)})),o.push(new Uint8Array(e)),o.flush()}else n(e)},togglePause:function(){this.isPause=!this.isPause,!this.isPause&&this.retryAll()},retry:function(e){var t=this;"error"===this.finishList[e].status&&(this.finishList[e].status="",this.ajax({url:this.tsUrlList[e],type:"file",success:function(n){t.errorNum--,t.dealTS(n,e)},fail:function(){t.finishList[e].status="error"}}))},retryAll:function(){this.finishList.forEach((function(e){"error"===e.status&&(e.status="")})),this.errorNum=0,this.downloadIndex=this.rangeDownload.startSegment-1,this.downloadTS()},downloadFile:function(e,t){this.tips="ts 碎片整合中，请留意浏览器下载";var n=null,i=document.createElement("a");this.isGetMP4?(n=new Blob(e,{type:"video/mp4"}),i.download=t+".mp4"):(n=new Blob(e,{type:"video/MP2T"}),i.download=t+".ts"),i.href=URL.createObjectURL(n),i.style.display="none",document.body.appendChild(i),i.click(),i.remove()},formatTime:function(e,t){var n={Y:e.getFullYear(),M:e.getMonth()+1,D:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds()};return t.replace(/Y+|M+|D+|h+|m+|s+/g,(function(e){return(new Array(e.length).join("0")+n[e[0]]).substr(-e.length)}))},forceDownload:function(){this.mediaFileList.length?this.downloadFile(this.mediaFileList,this.formatTime(this.beginTime,"YYYY_MM_DD hh_mm_ss")):alert("当前无已下载片段")},alertError:function(e){alert(e),this.downloading=!1,this.tips="m3u8 视频在线提取工具"},copyCode:function(){var e=this;"代码下载中，请稍后"!==this.tips&&(this.tips="代码下载中，请稍后",this.ajax({url:"/m3u8.html",success:function(t){var n=t.split("\x3c!--vue 前端框架--\x3e"),i=n[0],o=n[1]+n[2];o=(o=o.split("// script注入"))[1]+o[2],e.url&&(o=o.replace("url: '', // 在线链接","url: '".concat(e.url,"',")));var s="\n          // 注入html\n          let $section = document.createElement('section')\n          $section.innerHTML = `".concat(i,"`\n          $section.style.width = '100%'\n          $section.style.height = '800px'\n          $section.style.top = '0'\n          $section.style.left = '0'\n          $section.style.position = 'relative'\n          $section.style.zIndex = '9999'\n          $section.style.backgroundColor = 'white'\n          document.body.appendChild($section);\n\n          // 加载 ASE 解密\n          let $ase = document.createElement('script')\n          $ase.src = 'https://upyun.luckly-mjw.cn/lib/aes-decryptor.js'\n\n          // 加载 mp4 转码\n          let $mp4 = document.createElement('script')\n          $mp4.src = 'https://upyun.luckly-mjw.cn/lib/mux-mp4.js'\n\n          // 加载 vue\n          let $vue = document.createElement('script')\n          $vue.src = 'https://upyun.luckly-mjw.cn/lib/vue.js'\n\n          // 监听 vue 加载完成，执行业务代码\n          $vue.addEventListener('load', () => {").concat(o,"})\n          document.body.appendChild($vue);\n          document.body.appendChild($mp4);\n          document.body.appendChild($ase);\n\n          document.querySelector('.m-p-cross').remove();\n          alert('注入成功，请滚动到页面底部，若白屏则等待资源加载')\n          ");e.copyToClipboard(s),e.tips="复制成功，打开视频网页控制台，注入本代码"},fail:function(){e.alertError("链接不正确，请查看链接是否有效")}}))},copyToClipboard:function(e){if(clearTimeout(this.timeouter),!document.queryCommandSupported("copy"))return!1;var t=document.createElement("textarea");t.style.opacity="0",t.value=e,document.body.appendChild(t),t.select();var n=document.execCommand("copy");return document.body.removeChild(t),t=null,n}}},o=(n(643),n(13)),s=Object(o.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ClientOnly",[n("section",{attrs:{id:"m-app"}},[n("section",{staticClass:"m-p-action g-box"},[e._v(e._s(e.tips))]),e._v(" "),n("div",{staticClass:"m-p-temp-url"},[e._v("\n      测试链接：https://1257120875.vod2.myqcloud.com/0ef121cdvodtransgzp1257120875/3055695e5285890780828799271/v.f230.m3u8\n    ")]),e._v(" "),n("section",{staticClass:"m-p-input-container"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.url,expression:"url"}],attrs:{type:"text",disabled:e.downloading,placeholder:"请输入 m3u8 链接"},domProps:{value:e.url},on:{input:function(t){t.target.composing||(e.url=t.target.value)}}}),e._v(" "),!e.downloading||e.rangeDownload.isShowRange?[e.rangeDownload.isShowRange?[n("input",{directives:[{name:"model",rawName:"v-model",value:e.rangeDownload.startSegment,expression:"rangeDownload.startSegment"}],staticClass:"range-input",attrs:{type:"number",disabled:e.downloading,placeholder:"起始片段"},domProps:{value:e.rangeDownload.startSegment},on:{input:function(t){t.target.composing||e.$set(e.rangeDownload,"startSegment",t.target.value)}}}),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.rangeDownload.endSegment,expression:"rangeDownload.endSegment"}],staticClass:"range-input",attrs:{type:"number",disabled:e.downloading,placeholder:"截止片段"},domProps:{value:e.rangeDownload.endSegment},on:{input:function(t){t.target.composing||e.$set(e.rangeDownload,"endSegment",t.target.value)}}})]:n("div",{on:{click:function(t){return e.getM3U8(!0)}}},[e._v("特定范围下载")])]:e._e(),e._v(" "),e.downloading?e.finishNum===e.rangeDownload.targetSegment&&e.rangeDownload.targetSegment>0?n("div",{staticClass:"disable"},[e._v("\n        下载完成\n      ")]):n("div",{on:{click:e.togglePause}},[e._v(e._s(e.isPause?"恢复下载":"暂停下载"))]):[n("div",{on:{click:function(t){return e.getM3U8(!1)}}},[e._v("原格式下载")]),e._v(" "),n("div",{on:{click:e.getMP4}},[e._v("转码为MP4下载")])]],2),e._v(" "),n("div",{staticClass:"m-p-cross",on:{click:e.copyCode}},[e._v("当无法下载，资源发生跨域限制时，在视频源页面打开控制台，注入代码解决，点击本按钮复制代码")]),e._v(" "),e.finishList.length>0?[n("div",{staticClass:"m-p-line"}),e._v(" "),e.errorNum&&e.downloadIndex>=e.rangeDownload.targetSegment?n("div",{staticClass:"m-p-retry",on:{click:e.retryAll}},[e._v("\n        重新下载错误片段\n      ")]):e._e(),e._v(" "),e.mediaFileList.length?n("div",{staticClass:"m-p-force",on:{click:e.forceDownload}},[e._v("强制下载现有片段")]):e._e(),e._v(" "),n("div",{staticClass:"m-p-tips"},[e._v("待下载碎片总量："+e._s(e.rangeDownload.targetSegment)+"，已下载："+e._s(e.finishNum)+"，错误："+e._s(e.errorNum)+"，进度："+e._s((e.finishNum/e.rangeDownload.targetSegment*100).toFixed(2))+"%\n      ")]),e._v(" "),n("div",{staticClass:"m-p-tips",class:[e.errorNum?"error-tips":""]},[e._v("若某视频碎片下载发生错误，将标记为红色，可点击相应图标进行重试")]),e._v(" "),n("section",{staticClass:"m-p-segment"},e._l(e.finishList,(function(t,i){return n("div",{staticClass:"item",class:[t.status],attrs:{title:t.title},on:{click:function(t){return e.retry(i)}}},[e._v(e._s(i+1)+"\n        ")])})),0)]:e._e()],2)])}),[],!1,null,"42f4526c",null);t.default=s.exports}}]);